<!DOCTYPE html>
<!-- saved from url=(0059)https://www.cs.yale.edu/homes/aspnes/classes/223/notes.html -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="James Aspnes">
  <title>Notes on Data Structures and Programming Techniques (CPSC 223, Spring 2021)</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">
html {
font-size: 100%;
overflow-y: scroll;
-webkit-text-size-adjust: 100%;
-ms-text-size-adjust: 100%;
}
body {
color: #444;
font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif;
font-size: 12px;
line-height: 1.4;
padding: 1em;
margin: auto;
max-width: 44em;
background: #fefefe;
}
a {
color: #0645ad;
text-decoration: none;
}
a:visited {
color: #0b0080;
}
a:hover {
color: #06e;
}
a:active {
color: #faa700;
}
a:focus {
outline: thin dotted;
}
*::-moz-selection {
background: rgba(255, 255, 0, 0.3);
color: #000;
}
*::selection {
background: rgba(255, 255, 0, 0.3);
color: #000;
}
a::-moz-selection {
background: rgba(255, 255, 0, 0.3);
color: #0645ad;
}
a::selection {
background: rgba(255, 255, 0, 0.3);
color: #0645ad;
}
p {
margin: 1em 0;
}
img {
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
color: #111;
line-height: 125%;
margin-top: 2em;
font-weight: normal;
}
h4, h5, h6 {
font-weight: bold;
}
h1 {
font-size: 2.5em;
}
h2 {
font-size: 2em;
}
h3 {
font-size: 1.5em;
}
h4 {
font-size: 1.2em;
}
h5 {
font-size: 1em;
}
h6 {
font-size: 0.9em;
}
blockquote {
color: #666666;
margin: 0;
padding-left: 3em;
border-left: 0.5em #EEE solid;
}
hr {
display: block;
height: 2px;
border: 0;
border-top: 1px solid #aaa;
border-bottom: 1px solid #eee;
margin: 1em 0;
padding: 0;
}
pre, code, kbd, samp {
color: #000;
font-family: monospace, monospace;
_font-family: 'courier new', monospace;
font-size: 0.98em;
}
pre {
white-space: pre;
white-space: pre-wrap;
word-wrap: break-word;
}
b, strong {
font-weight: bold;
}
dfn {
font-style: italic;
}
ins {
background: #ff9;
color: #000;
text-decoration: none;
}
mark {
background: #ff0;
color: #000;
font-style: italic;
font-weight: bold;
}
sub, sup {
font-size: 75%;
line-height: 0;
position: relative;
vertical-align: baseline;
}
sup {
top: -0.5em;
}
sub {
bottom: -0.25em;
}
ul, ol {
margin: 1em 0;
padding: 0 0 0 2em;
}
li p:last-child {
margin-bottom: 0;
}
ul ul, ol ol {
margin: .3em 0;
}
dl {
margin-bottom: 1em;
}
dt {
font-weight: bold;
margin-bottom: .8em;
}
dd {
margin: 0 0 .8em 2em;
}
dd:last-child {
margin-bottom: 0;
}
img {
border: 0;
-ms-interpolation-mode: bicubic;
vertical-align: middle;
}
figure {
display: block;
text-align: center;
margin: 1em 0;
}
figure img {
border: none;
margin: 0 auto;
}
figcaption {
font-size: 0.8em;
font-style: italic;
margin: 0 0 .8em;
}
table {
margin-bottom: 2em;
border-bottom: 1px solid #ddd;
border-right: 1px solid #ddd;
border-spacing: 0;
border-collapse: collapse;
}
table th {
padding: .2em 1em;
background-color: #eee;
border-top: 1px solid #ddd;
border-left: 1px solid #ddd;
}
table td {
padding: .2em 1em;
border-top: 1px solid #ddd;
border-left: 1px solid #ddd;
vertical-align: top;
}
.author {
font-size: 1.2em;
text-align: center;
}
@media only screen and (min-width: 480px) {
body {
font-size: 14px;
}
}
@media only screen and (min-width: 768px) {
body {
font-size: 16px;
}
}
@media print {
* {
background: transparent !important;
color: black !important;
filter: none !important;
-ms-filter: none !important;
}
body {
font-size: 12pt;
max-width: 100%;
}
a, a:visited {
text-decoration: underline;
}
hr {
height: 1px;
border: 0;
border-bottom: 1px solid black;
}
a[href]:after {
content: " (" attr(href) ")";
}
abbr[title]:after {
content: " (" attr(title) ")";
}
.ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
content: "";
}
pre, blockquote {
border: 1px solid #999;
padding-right: 1em;
page-break-inside: avoid;
}
tr, img {
page-break-inside: avoid;
}
img {
max-width: 100% !important;
}
@page :left {
margin: 15mm 20mm 15mm 10mm;
}
@page :right {
margin: 15mm 10mm 15mm 20mm;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3 {
page-break-after: avoid;
}
}
</style>
<dt>2021-03-10</dt><dd>Managing large C programs: more on source files vs header files, <code>static</code> functions, opaque structs and typedefs, linking, <code>make</code>. The <code>stdio.h</code> library and file I/O. Readings: <a href="output.html#modules">Function declarations and modules</a>, <a href="output.html#make">Make</a>, <a href="output.html#FILE_IO">File I/O</a>. <a href="https://www.cs.yale.edu/homes/aspnes/classes/223/examples/2021/lecture/2021-03-10">Examples from lecture</a>.
</dd><h3 id="modules"><span class="header-section-number">4.8.5</span> Function declarations and modules</h3>
<p>By default, functions have <strong>global scope</strong>: they can be used anywhere in your program, even in other files. If a file doesn’t contain a declaration for a function <code class="backtick">someFunc</code> before it is used, the compiler will assume that it is declared like <code class="backtick">int someFunc()</code> (i.e., return type <code class="backtick">int</code> and unknown arguments). This can produce infuriating complaints later when the compiler hits the real declaration and insists that your function <code class="backtick">someFunc</code> should be returning an <code class="backtick">int</code> and you are a bonehead for declaring it otherwise.</p>
<p>The solution to such insulting compiler behavior errors is to either (a) move the function declaration before any functions that use it; or (b) put in a declaration without a body before any functions that use it, in addition to the declaration that appears in the function definition. (Note that this violates the <strong>no separate but equal</strong> rule, but the compiler should tell you when you make a mistake.) Option (b) is generally preferred, and is the only option when the function is used in a different file.</p>
<p>To make sure that all declarations of a function are consistent, the usual practice is to put them in an include file. For example, if <code class="backtick">distSquared</code> is used in a lot of places, we might put it in its own file <code class="backtick">distSquared.c</code>:</p>
<div>
<div class="sourceCode" id="cb187"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb187-1" title="1"><span class="pp">#include </span><span class="im">"distSquared.h"</span></a>
<a class="sourceLine" id="cb187-2" title="2"></a>
<a class="sourceLine" id="cb187-3" title="3"><span class="dt">int</span></a>
<a class="sourceLine" id="cb187-4" title="4">distSquared(<span class="dt">int</span> dx, <span class="dt">int</span> dy)</a>
<a class="sourceLine" id="cb187-5" title="5">{</a>
<a class="sourceLine" id="cb187-6" title="6">    <span class="cf">return</span> dx*dx + dy*dy;</a>
<a class="sourceLine" id="cb187-7" title="7">}</a></code></pre></div>
<a href="https://www.cs.yale.edu/homes/aspnes/classes/223/examples/functions/distSquared.c">examples/functions/distSquared.c</a>
</div>
<p>The file <code>distSquared.c</code> above uses <code class="backtick">#include</code> to include a copy of the following header file <code>distSquared.h</code>:</p>
<div>
<div class="sourceCode" id="cb188"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb188-1" title="1"><span class="co">/* Returns the square of the distance between two points separated by </span></a>
<a class="sourceLine" id="cb188-2" title="2"><span class="co">   dx in the x direction and dy in the y direction. */</span></a>
<a class="sourceLine" id="cb188-3" title="3"><span class="dt">int</span> distSquared(<span class="dt">int</span> dx, <span class="dt">int</span> dy);</a></code></pre></div>
<a href="https://www.cs.yale.edu/homes/aspnes/classes/223/examples/functions/distSquared.h">examples/functions/distSquared.h</a>
</div>
<p>Note that the declaration in <code class="backtick">distSquared.h</code> doesn’t have a body. Instead, it’s terminated by a semicolon, like a variable declaration. It’s also worth noting that we moved the documenting comment to <code class="backtick">distSquared.h</code>: the idea is that <code class="backtick">distSquared.h</code> is the public face of this (very small one-function) module, and so the explanation of how to use the function should be there.</p>
<p>The reason <code class="backtick">distSquared.c</code> includes <code class="backtick">distSquared.h</code> is to get the compiler to verify that the declarations in the two files match. But to use the <code class="backtick">distSquared</code> function, we also put <code class="backtick">#include "distSquared.h"</code> at the top of the file that uses it:</p>
<div>
<div class="sourceCode" id="cb189"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb189-1" title="1"><span class="pp">#include </span><span class="im">"distSquared.h"</span></a>
<a class="sourceLine" id="cb189-2" title="2"></a>
<a class="sourceLine" id="cb189-3" title="3"><span class="pp">#define THRESHOLD (100)</span></a>
<a class="sourceLine" id="cb189-4" title="4"></a>
<a class="sourceLine" id="cb189-5" title="5"><span class="dt">int</span></a>
<a class="sourceLine" id="cb189-6" title="6">tooClose(<span class="dt">int</span> x1, <span class="dt">int</span> y1, <span class="dt">int</span> x2, <span class="dt">int</span> y2)</a>
<a class="sourceLine" id="cb189-7" title="7">{</a>
<a class="sourceLine" id="cb189-8" title="8">    <span class="cf">return</span> distSquared(x1 - x2, y1 - y2) &lt; THRESHOLD;</a>
<a class="sourceLine" id="cb189-9" title="9">}</a></code></pre></div>
<a href="https://www.cs.yale.edu/homes/aspnes/classes/223/examples/functions/tooClose.c">examples/functions/tooClose.c</a>
</div>
<p>The <code class="backtick">#include</code> on line 1 uses double quotes instead of angle brackets; this tells the compiler to look for <code class="backtick">distSquared.h</code> in the current directory instead of the system include directory (typically <code class="backtick">/usr/include</code>).</p>
<h3 id="make"><span class="header-section-number">3.3.2</span> Make</h3>
<p>For complicated programs involving multiple source files, you are probably better off using <code>make</code> than calling <code>gcc</code> directly. Make is a “rule-based expert system” that figures out how to compile programs given a little bit of information about their components.</p>
<p>For example, if you have a file called <code>foo.c</code>, try typing <code>make foo</code> and see what happens.</p>
<p>In general you will probably want to write a <code>Makefile</code>, which is named <code>Makefile</code> or <code>makefile</code> and tells <code>make</code> how to compile programs in the same directory. Here’s a typical Makefile:</p>
<div>
<div class="sourceCode" id="cb12"><pre class="sourceCode makefile"><code class="sourceCode makefile"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># Any line that starts with a sharp is a comment and is ignored</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co"># by Make.</span></a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co"># These lines set variables that control make's default rules.</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co"># We STRONGLY recommend putting "-Wall -pedantic -g3" in your CFLAGS.</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="dt">CC</span><span class="ch">=</span><span class="st">gcc</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="dt">CFLAGS=-std</span><span class="ch">=</span><span class="st">c99 -Wall -pedantic -g3</span></a>
<a class="sourceLine" id="cb12-8" title="8"></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co"># The next line is a dependency line.</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co"># It says that if somebody types "make all"</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co"># make must first make "hello-world".</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co"># By default the left-hand-side of the first dependency is what you</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co"># get if you just type "make" with no arguments.</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="dv">all:</span><span class="dt"> hello-world</span></a>
<a class="sourceLine" id="cb12-15" title="15"></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co"># How do we make hello-world?</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co"># The dependency line says you need to first make hello-world.o</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co"># and hello-library.o</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="dv">hello-world:</span><span class="dt"> hello-world.o hello-library.o</span></a>
<a class="sourceLine" id="cb12-20" title="20">	<span class="co"># Subsequent lines starting with a TAB character give</span></a>
<a class="sourceLine" id="cb12-21" title="21">	<span class="co"># commands to execute.</span></a>
<a class="sourceLine" id="cb12-22" title="22">	<span class="co"># This command uses make built-in variables to avoid</span></a>
<a class="sourceLine" id="cb12-23" title="23">	<span class="co"># retyping (and getting things wrong):</span></a>
<a class="sourceLine" id="cb12-24" title="24">	<span class="co">#  $@ = target hello-world</span></a>
<a class="sourceLine" id="cb12-25" title="25">	<span class="co">#  $^ = dependencies hello-world.o and hello-library.o</span></a>
<a class="sourceLine" id="cb12-26" title="26">	<span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -o <span class="ch">$@</span> <span class="ch">$^</span></a>
<a class="sourceLine" id="cb12-27" title="27">	<span class="co"># You can put whatever commands you want.</span></a>
<a class="sourceLine" id="cb12-28" title="28">	echo <span class="st">"I just built hello-world!  Hooray!"</span></a>
<a class="sourceLine" id="cb12-29" title="29"></a>
<a class="sourceLine" id="cb12-30" title="30"><span class="co"># Here we are saying that hello-world.o and hello-library.o</span></a>
<a class="sourceLine" id="cb12-31" title="31"><span class="co">#  should be rebuilt whenever their corresponding source file</span></a>
<a class="sourceLine" id="cb12-32" title="32"><span class="co">#  or hello-library.h changes.</span></a>
<a class="sourceLine" id="cb12-33" title="33"><span class="co"># There are no commands attached to these dependency lines, so</span></a>
<a class="sourceLine" id="cb12-34" title="34"><span class="co">#  make will have to figure out how to do that somewhere else</span></a>
<a class="sourceLine" id="cb12-35" title="35"><span class="co">#  (probably from the builtin .c -&gt; .o rule).</span></a>
<a class="sourceLine" id="cb12-36" title="36"><span class="dv">hello-world.o:</span><span class="dt"> hello-world.c hello-library.h</span></a>
<a class="sourceLine" id="cb12-37" title="37"><span class="dv">hello-library.o:</span><span class="dt"> hello-library.c hello-library.h</span></a>
<a class="sourceLine" id="cb12-38" title="38"></a>
<a class="sourceLine" id="cb12-39" title="39"><span class="co"># Command lines can do more than just build things.  For example,</span></a>
<a class="sourceLine" id="cb12-40" title="40"><span class="co"># "make test" will rebuild hello-world (if necessary) and then run it.</span></a>
<a class="sourceLine" id="cb12-41" title="41"><span class="dv">test:</span><span class="dt"> hello-world</span></a>
<a class="sourceLine" id="cb12-42" title="42">	./hello-world</a>
<a class="sourceLine" id="cb12-43" title="43"></a>
<a class="sourceLine" id="cb12-44" title="44"><span class="co"># This lets you type "make clean" and get rid of anything you can</span></a>
<a class="sourceLine" id="cb12-45" title="45"><span class="co"># rebuild.  The $(RM) variable is predefined to "rm -f"</span></a>
<a class="sourceLine" id="cb12-46" title="46"><span class="dv">clean:</span></a>
<a class="sourceLine" id="cb12-47" title="47">	<span class="ch">$(</span><span class="dt">RM</span><span class="ch">)</span> hello-world *.o</a></code></pre></div>
<a href="https://www.cs.yale.edu/homes/aspnes/classes/223/examples/usingMake/Makefile">examples/usingMake/Makefile</a>
</div>
<p>Given a Makefile, make looks at each dependency line and asks: (a) does the target on the left hand side exist, and (b) is it older than the files it depends on. If so, it looks for a set of commands for rebuilding the target, after first rebuilding any of the files it depends on; the commands it runs will be underneath some dependency line where the target appears on the left-hand side. It has built-in rules for doing common tasks like building <code>.o</code> files (which contain machine code) from <code>.c</code> files (which contain C source code). If you have a fake target like <code>all</code> above, it will try to rebuild everything <code>all</code> depends on because there is no file named <code>all</code> (one hopes).</p>
<h4 id="Make_gotchas"><span class="header-section-number">3.3.2.1</span> Make gotchas</h4>
<p>Make really really cares that the command lines start with a TAB character. TAB looks like eight spaces in Emacs and other editors, but it isn’t the same thing. If you put eight spaces in (or a space and a TAB), Make will get horribly confused and give you an incomprehensible error message about a “missing separator”. This misfeature is so scary that I avoided using make for years because I didn’t understand what was going on. Don’t fall into that trap—make really is good for you, especially if you ever need to recompile a huge program when only a few source files have changed.</p>
<p>If you use GNU Make (on a zoo node), note that beginning with version 3.78, GNU Make prints a message that hints at a possible SPACEs-vs-TAB problem, like this:</p>
<pre><code>$ make
Makefile:23:*** missing separator (did you mean TAB instead of 8 spaces?).  Stop.</code></pre>
<p>If you need to repair a Makefile that uses spaces, one way of converting leading spaces into TABs is to use the <code>unexpand</code> program:</p>
<pre><code>$ mv Makefile Makefile.old
$ unexpand Makefile.old &gt; Makefile</code></pre>
<h3 style="color:red"> ID not found: FILE_IO </h3>
